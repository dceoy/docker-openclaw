services:
  openclaw-gateway:
    container_name: openclaw-gateway
    build:
      context: .
      dockerfile: Dockerfile
      target: openclaw
      args:
        NODE_VERSION: ${OPENCLAW_NODE_VERSION:-${CLAWDBOT_NODE_VERSION:-22}}
        OPENCLAW_VERSION: ${OPENCLAW_VERSION:-${CLAWDBOT_VERSION:-latest}}
      platforms:
        - linux/amd64
        - linux/arm64
    image: ${OPENCLAW_IMAGE:-${CLAWDBOT_IMAGE:-openclaw}}:${OPENCLAW_VERSION:-${CLAWDBOT_VERSION:-latest}}
    hostname: openclaw-gateway
    environment:
      HOME: /home/node
      TERM: xterm-256color
      NODE_ENV: production
      CLAUDE_AI_SESSION_KEY: ${CLAUDE_AI_SESSION_KEY:-}
      CLAUDE_WEB_SESSION_KEY: ${CLAUDE_WEB_SESSION_KEY:-}
      CLAUDE_WEB_COOKIE: ${CLAUDE_WEB_COOKIE:-}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      ELEVENLABS_API_KEY: ${ELEVENLABS_API_KEY:-}
    volumes:
      - ${OPENCLAW_CONFIG_DIR:-${CLAWDBOT_CONFIG_DIR:-./.openclaw}}:/home/node/.openclaw
      - ${OPENCLAW_WORKSPACE_DIR:-${CLAWDBOT_WORKSPACE_DIR:-./workspace}}:/workspace
    ports:
      - "${OPENCLAW_GATEWAY_PORT:-${CLAWDBOT_GATEWAY_PORT:-18789}}:18789"
      - "${OPENCLAW_GATEWAY_WS_PORT:-${CLAWDBOT_GATEWAY_WS_PORT:-18790}}:18790"
    restart: unless-stopped
    command: ["openclaw", "gateway", "--bind", "0.0.0.0"]

  openclaw-cli:
    container_name: openclaw-cli
    build:
      context: .
      dockerfile: Dockerfile
      target: openclaw
      args:
        NODE_VERSION: ${OPENCLAW_NODE_VERSION:-${CLAWDBOT_NODE_VERSION:-22}}
        OPENCLAW_VERSION: ${OPENCLAW_VERSION:-${CLAWDBOT_VERSION:-latest}}
    image: ${OPENCLAW_IMAGE:-${CLAWDBOT_IMAGE:-openclaw}}:${OPENCLAW_VERSION:-${CLAWDBOT_VERSION:-latest}}
    hostname: openclaw-cli
    environment:
      HOME: /home/node
      TERM: xterm-256color
      CLAUDE_AI_SESSION_KEY: ${CLAUDE_AI_SESSION_KEY:-}
      CLAUDE_WEB_SESSION_KEY: ${CLAUDE_WEB_SESSION_KEY:-}
      CLAUDE_WEB_COOKIE: ${CLAUDE_WEB_COOKIE:-}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      ELEVENLABS_API_KEY: ${ELEVENLABS_API_KEY:-}
    volumes:
      - ${OPENCLAW_CONFIG_DIR:-${CLAWDBOT_CONFIG_DIR:-./.openclaw}}:/home/node/.openclaw
      - ${OPENCLAW_WORKSPACE_DIR:-${CLAWDBOT_WORKSPACE_DIR:-./workspace}}:/workspace
    stdin_open: true
    tty: true
    profiles:
      - cli
    entrypoint: ["/usr/bin/tini", "--"]
    command: ["openclaw"]

  openclaw-sandbox:
    container_name: openclaw-sandbox
    build:
      context: .
      dockerfile: Dockerfile
      target: openclaw-sandbox
      args:
        NODE_VERSION: ${OPENCLAW_NODE_VERSION:-${CLAWDBOT_NODE_VERSION:-22}}
        OPENCLAW_VERSION: ${OPENCLAW_VERSION:-${CLAWDBOT_VERSION:-latest}}
        OPENCLAW_DOCKER_APT_PACKAGES: ${OPENCLAW_DOCKER_APT_PACKAGES:-${CLAWDBOT_DOCKER_APT_PACKAGES:-}}
    image: ${OPENCLAW_IMAGE:-${CLAWDBOT_IMAGE:-openclaw}}:${OPENCLAW_VERSION:-${CLAWDBOT_VERSION:-latest}}-sandbox
    hostname: openclaw-sandbox
    environment:
      HOME: /home/node
      TERM: xterm-256color
      NODE_ENV: production
      CLAUDE_AI_SESSION_KEY: ${CLAUDE_AI_SESSION_KEY:-}
      CLAUDE_WEB_SESSION_KEY: ${CLAUDE_WEB_SESSION_KEY:-}
      CLAUDE_WEB_COOKIE: ${CLAUDE_WEB_COOKIE:-}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      ELEVENLABS_API_KEY: ${ELEVENLABS_API_KEY:-}
    volumes:
      - ${OPENCLAW_CONFIG_DIR:-${CLAWDBOT_CONFIG_DIR:-./.openclaw}}:/home/node/.openclaw
      - ${OPENCLAW_WORKSPACE_DIR:-${CLAWDBOT_WORKSPACE_DIR:-./workspace}}:/workspace
    ports:
      - "${OPENCLAW_SANDBOX_PORT:-${CLAWDBOT_SANDBOX_PORT:-18791}}:18789"
      - "${OPENCLAW_SANDBOX_WS_PORT:-${CLAWDBOT_SANDBOX_WS_PORT:-18792}}:18790"
    restart: unless-stopped
    profiles:
      - sandbox
    command: ["openclaw", "gateway", "--bind", "0.0.0.0"]

  openclaw-browser:
    container_name: openclaw-browser
    build:
      context: .
      dockerfile: Dockerfile
      target: openclaw-browser
      args:
        NODE_VERSION: ${OPENCLAW_NODE_VERSION:-${CLAWDBOT_NODE_VERSION:-22}}
        OPENCLAW_VERSION: ${OPENCLAW_VERSION:-${CLAWDBOT_VERSION:-latest}}
    image: ${OPENCLAW_IMAGE:-${CLAWDBOT_IMAGE:-openclaw}}:${OPENCLAW_VERSION:-${CLAWDBOT_VERSION:-latest}}-browser
    hostname: openclaw-browser
    environment:
      HOME: /home/node
      TERM: xterm-256color
      NODE_ENV: production
      CHROME_PATH: /usr/bin/chromium
      PUPPETEER_EXECUTABLE_PATH: /usr/bin/chromium
      PUPPETEER_SKIP_CHROMIUM_DOWNLOAD: "true"
      CLAUDE_AI_SESSION_KEY: ${CLAUDE_AI_SESSION_KEY:-}
      CLAUDE_WEB_SESSION_KEY: ${CLAUDE_WEB_SESSION_KEY:-}
      CLAUDE_WEB_COOKIE: ${CLAUDE_WEB_COOKIE:-}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      ELEVENLABS_API_KEY: ${ELEVENLABS_API_KEY:-}
    volumes:
      - ${OPENCLAW_CONFIG_DIR:-${CLAWDBOT_CONFIG_DIR:-./.openclaw}}:/home/node/.openclaw
      - ${OPENCLAW_WORKSPACE_DIR:-${CLAWDBOT_WORKSPACE_DIR:-./workspace}}:/workspace
    ports:
      - "${OPENCLAW_BROWSER_PORT:-${CLAWDBOT_BROWSER_PORT:-18793}}:18789"
      - "${OPENCLAW_BROWSER_WS_PORT:-${CLAWDBOT_BROWSER_WS_PORT:-18794}}:18790"
    restart: unless-stopped
    profiles:
      - browser
    security_opt:
      - seccomp=unconfined
    command: ["openclaw", "gateway", "--bind", "0.0.0.0"]
